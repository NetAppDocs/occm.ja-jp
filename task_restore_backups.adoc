---
sidebar: sidebar 
permalink: task_restore_backups.html 
keywords: restoring, restore, restore volumes, restore files, Cloud Backup, cloud backup service, single file restore 
summary: バックアップは、特定の時点のデータをリストアできるように、クラウドアカウントのオブジェクトストアに格納されます。保存したバックアップファイルからボリューム全体をリストアすることも、いくつかのファイルのみをリストアする必要がある場合は、保存したバックアップファイルから最大 8 つのファイルを（一度に）リストアすることもできます。 
---
= バックアップファイルからのデータのリストア
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
バックアップは、特定の時点のデータをリストアできるように、クラウドアカウントのオブジェクトストアに格納されます。保存したバックアップファイルからボリューム全体をリストアすることも、いくつかのファイルのみをリストアする必要がある場合は、保存したバックアップファイルから最大 8 つのファイルを（一度に）リストアすることもできます。

ボリューム全体を同じ作業環境、同じクラウドアカウントを使用している別の作業環境、またはオンプレミスの ONTAP システムにリストアできます。を参照してください <<Restoring a volume from a backup file,バックアップからのボリュームのリストア>>。

同じ作業環境内のボリューム、同じクラウドアカウントを使用している別の作業環境内のボリューム、またはオンプレミスの ONTAP システム上のボリュームにファイルをリストアできます。を参照してください <<Restoring files from a backup,バックアップからのファイルのリストア>>。



== サポートされている作業環境とオブジェクトストレージプロバイダ

ボリュームまたは個々のファイルをバックアップファイルから次の作業環境にリストアできます。

[cols="25,40,40"]
|===
| バックアップファイルの場所 2+| デスティネーションの作業環境 


|  | * ボリュームの復元 * | * ファイルの復元 * 


| Amazon S3 | オンプレミスの AWS ONTAP システムに Cloud Volumes ONTAP が導入されている | オンプレミスの AWS ONTAP システムに Cloud Volumes ONTAP が導入されている 


| Azure Blob の略 | オンプレミスの Azure ONTAP システムに Cloud Volumes ONTAP を導入 | オンプレミスの Azure ONTAP システムに Cloud Volumes ONTAP を導入 


| Google クラウドストレージ | Google オンプレミス ONTAP システムの Cloud Volumes ONTAP |  
|===


== リストアダッシュボード

リストアダッシュボードにアクセスするには、 Cloud Manager の上部にある * リストア * タブをクリックするか、サービスパネルからリストアサービスの * アクティブ化 * または * 有効化 * ボタンをクリックします。


NOTE: 少なくとも 1 つの作業環境に対して Cloud Backup Service がアクティブ化されている必要があります。

image:screenshot_restore_dashboard.png["リストアダッシュボードには、ボリュームとファイルをリストアするためのボタンと、リストアされたすべてのデータの表示方法が表示されます。"]

リストアダッシュボードには、ボリュームとファイルをリストアするためのボタンがあります。[ ボリュームの復元 ] または [ ファイルの復元 ] ボタンをクリックすると、ウィザードが起動され、データを復元する手順が示されます。

ダッシュボードには、以前のリストア操作の履歴が必要な場合に備えて、リストアしたすべてのボリュームとすべてのファイルのリストも表示されます。リストアされた各ボリュームまたはファイルの行を展開すると、ボリュームまたはファイルのソースとデスティネーションの場所に関する詳細を確認できます。



== バックアップファイルからのボリュームのリストア

バックアップファイルからボリュームをリストアすると、 Cloud Manager はバックアップのデータを使用して _new_volume を作成します。データは、同じ作業環境内のボリューム、またはソース作業環境と同じクラウドアカウントにある別の作業環境にリストアできます。オンプレミスの ONTAP システムにファイルをリストアすることもできます。

リストアするボリュームの名前と、新規にリストアされたボリュームの作成に使用するバックアップファイルの日付を把握しておく必要があります。

.手順
. [ * リストア * ] タブを選択します。
+
リストアダッシュボードが表示されます。

. ［ * リストアボリューム * ］ をクリックします。
+
image:screenshot_restore_volume_selection.png["Restore Dashboard から Restore Volumes （ボリュームの復元）ボタンを選択するスクリーンショット。"]

. [ ソースの選択 ] ページで ' リストアするボリュームのバックアップ・ファイル（スナップショット）に移動しますリストアする日付とタイムスタンプの * Working Environment * 、 * Volume * 、および * Snapshot * を選択します。
+
image:screenshot_restore_select_volume_snapshot.png["リストアする作業環境、ボリューム、およびボリューム Snapshot を選択するスクリーンショット。"]

. [* Continue （続行） ] をクリックします
. [ リストア先の選択 ] ページで、ボリュームをリストアする * 作業環境 * を選択します。
+
image:screenshot_restore_select_work_env_volume.png["リストアするボリュームのデスティネーション作業環境の選択のスクリーンショット。"]

. オンプレミスの ONTAP システムを選択し、オブジェクトストレージへのクラスタ接続をまだ設定していない場合は、追加情報を入力するように求められます。
+
** Amazon S3 からリストアする場合は、デスティネーションボリュームが配置されている ONTAP クラスタの IPspace と、オブジェクトストレージへのアクセスに必要な AWS Access Key および Secret Key を入力します。
** Azure Blob からリストアする場合は、デスティネーションボリュームが配置されている ONTAP クラスタ内の IPspace を入力します。
** Google Cloud Storage からリストアする場合は、デスティネーションボリュームが配置されている ONTAP クラスタの IPspace と、オブジェクトストレージへのアクセスに必要なアクセスキーとシークレットキーを入力します。


. ボリュームを配置する Storage VM を選択し、リストアするボリュームに使用する名前を入力します。デフォルトでは、 * <source_volume_name> _ Restore * がボリューム名として使用されます。
+
image:screenshot_restore_new_vol_name.png["リストアするファイルのボリュームとフォルダを選択するスクリーンショット。"]

+
オンプレミスの ONTAP システムにボリュームをリストアする際に、ボリュームの容量に使用するアグリゲートを選択できます。

. リストアの進行状況を確認できるように、 * リストア * をクリックするとリストアダッシュボードに戻ります。


Cloud Manager は、選択したバックアップに基づいて新しいボリュームを作成します。可能です link:task_managing_storage.html#managing-existing-volumes["この新しいボリュームを管理します"^] 必要に応じて。



== バックアップからのファイルのリストア

ボリュームから数個のファイルのみをリストアする必要がある場合は、ボリューム全体をリストアする代わりに、個々のファイルをリストアすることもできます。同じ作業環境内のボリューム、または同じクラウドアカウントを使用している別の作業環境にファイルをリストアできます。オンプレミスの ONTAP システムにファイルをリストアすることもできます。

バックアップファイル内のボリュームから一度に最大 8 個のファイルをリストアできます。選択したデスティネーションボリュームにすべてのファイルがリストアされます。8 個以上のファイルをリストアする必要がある場合は、リストアプロセスをもう一度実行できます。


NOTE: バックアップファイルから個々のファイルをリストアする場合は、別のリストアインスタンス / 仮想マシンを使用します。



=== ファイルのリストアプロセス

プロセスは次のようになります。

. ボリュームから 1 つ以上のファイルを復元する場合は、 [ 復元 ] タブをクリックし、 [* ファイルの復元 *] をクリックして、ファイルが存在するバックアップファイル（またはファイル）を選択します。
. Restore インスタンスが起動し、バックアップファイル内に存在するフォルダとファイルが表示されます。
+
* 注：リストアインスタンスは、ファイルを初めてリストアするときにクラウドプロバイダの環境に導入されます。

. バックアップからリストアするファイル（複数可）を選択します。
. ファイル（作業環境、ボリューム、およびフォルダ）をリストアする場所を選択し、 * リストア * をクリックします。
. ファイルがリストアされ、リストアインスタンスがシャットダウンされて、一定時間非アクティブになったあとのコストが削減されます。




=== 詳細

を参照してください link:concept_backup_to_cloud.html#cost["このトピック"^] Cloud Backup Service と Restore インスタンスのコストを計算します。

.インスタンスタイプ
* AWS では、 Restore インスタンスはで実行されます https://aws.amazon.com/ec2/instance-types/m5/["m5n.xlarge インスタンス"^] CPU × 4 、 16GiB メモリ、 EBS のみのインスタンスストレージ。m5n.xlarge インスタンスを使用できない領域では、代わりに m5.xlarge インスタンスで Restore が実行されます。
* Azure では、 Restore 仮想マシンがで実行されます https://docs.microsoft.com/en-us/azure/virtual-machines/dv3-dsv3-series#dsv3-series["Standard_D4s_v3 VM"^] CPU × 4 、 16GiB メモリ、 32GB ディスク × 1


インスタンスの名前は _Cloud-Restore-Instance_with Your Account ID Concatenated です。例： _Cloud-Restore-Instance-MyAccount_ 。



=== 前提条件の確認

Cloud Restore を導入する前に、次の前提条件を確認し、サポートされている構成であることを確認してください。



==== AWS 権限が必要です

AWS でファイルリストアを使用する場合、 Cloud Manager に権限を提供する IAM ロールに最新の S3 権限を含める必要があります https://mysupport.netapp.com/site/info/cloud-manager-policies["Cloud Manager ポリシー"^] を参照してください link:task_backup_to_s3.html#requirements["AWS の要件"^]。

また、ファイルをリストアするには、ポリシーで次の権限が必要です。

[source, json]
----
  "Action": [
    "ec2:DescribeInstanceTypeOfferings",
    "ec2:startInstances",
    "ec2:stopInstances",
    "ec2:terminateInstances"
  ],
----


==== アウトバウンドインターネットアクセスを有効にします

Cloud Restore にはアウトバウンドのインターネットアクセスが必要です。仮想ネットワークまたは物理ネットワークでインターネットアクセスにプロキシサーバを使用している場合は、インスタンスがアウトバウンドのインターネットアクセスを使用して次のエンドポイントに接続していることを確認してください。クラウドに Cloud Restore を導入する場合、 Connector と同じサブネットに配置されます。

AWS と Azure のどちらに Cloud Restore を導入するかに応じて、該当する表を確認します。

* AWS 環境に必要なエンドポイント： *

[cols="43,57"]
|===
| エンドポイント | 目的 


| \ http://amazonlinux.us-east-1.amazonaws.com/2/extras/docker/stable/x86_64/4bf88ee77c395ffe1e0c3ca68530dfb3a683ec65a4a1ce9c0ff394be50e922b2/ | クラウドリストアインスタンス AMI 用の CentOS パッケージ。 


| ¥ http://cloudmanagerinfraprod.azurecr.io ¥ https://cloudmanagerinfraprod.azurecr.io | Cloud Restore Instance のイメージリポジトリ。 
|===
* Azure 導入に必要なエンドポイント： *

[cols="43,57"]
|===
| エンドポイント | 目的 


| ¥ http://olcentgbl.trafficmanager.net ¥ https://olcentgbl.trafficmanager.net | Cloud Restore 仮想マシン用の CentOS パッケージが用意されています。 


| ¥ http://cloudmanagerinfraprod.azurecr.io ¥ https://cloudmanagerinfraprod.azurecr.io | Cloud Restore Instance のイメージリポジトリ。 
|===


=== バックアップファイルからの単一ファイルのリストア

ボリュームバックアップからボリュームに最大 8 つのファイルをリストアする手順は、次のとおりです。ボリュームの名前と、ファイルのリストアに使用するバックアップファイルの日付を確認しておく必要があります。この機能では、ライブブラウズを使用して、バックアップファイル内のディレクトリとファイルのリストを表示できます。

バックアップファイルは NetApp Snapshot テクノロジを使用して作成されるため、 UI の中の表現では、各バックアップファイルに「 snapshot 」が呼び出されます。

次のビデオでは、 1 つのファイルをリストアする手順を簡単に紹介します。

video::ROAY6gPL9N0[youtube, width=848,height=480]

NOTE: ソースおよびデスティネーションの ONTAP システムで ONTAP のバージョンが 9.6 以降である必要があります。

.手順
. [* リストア *] タブをクリックします。
+
リストアダッシュボードが表示されます。

. [ ファイルの復元 *] ボタンをクリックします。
+
image:screenshot_restore_files_selection.png["Restore Dashboard から Restore Volumes （ボリュームの復元）ボタンを選択するスクリーンショット。"]

. [ ソースの選択 ] ページで ' リストアするファイルを含むボリュームのバックアップ・ファイル（スナップショット）に移動しますファイルのリストア元の日付とタイムスタンプが指定された * Working Environment * 、 * Volume * 、および * Snapshot * を選択します。
+
image:screenshot_restore_select_source.png["リストアするファイルのボリュームと Snapshot を選択するスクリーンショット。"]

. [* Continue （続行） ] をクリックすると、リストアインスタンスが開始されます。数分後、リストアインスタンスによってボリューム Snapshot のフォルダとファイルのリストが表示されます。
+
* 注：リストアインスタンスは、ファイルを初めてリストアするときにクラウドプロバイダの環境に導入されるため、初回のリストアには数分かかることがあります。

+
image:screenshot_restore_select_files.png["リストアするファイルに移動できるように、ファイルの選択ページのスクリーンショット。"]

. _ ファイルの選択 _ ページで、復元するファイルを選択し、 * 続行 * をクリックします。
+
** 検索アイコンをクリックしてファイル名を入力すると、そのファイルに直接移動できます。
** ファイル名が表示されている場合は、そのファイル名をクリックします。
** を使用して、フォルダ内の下位レベルに移動できます image:button_subfolder.png[""] ボタンをクリックして、ファイルを検索します。
+
ファイルを選択すると、ページの左側に追加され、選択済みのファイルが表示されます。必要に応じて、ファイル名の横にある * x * をクリックすると、このリストからファイルを削除できます。



. 保存先の選択ページで、ファイルを復元する * 作業環境 * を選択します。
+
image:screenshot_restore_select_work_env.png["リストアするファイルのデスティネーション作業環境の選択のスクリーンショット。"]

+
オンプレミスクラスタを選択し、オブジェクトストレージへのクラスタ接続をまだ設定していない場合は、追加情報を入力するように求められます。

+
** Amazon S3 からリストアする場合は、デスティネーションボリュームが配置されている ONTAP クラスタの IPspace と、オブジェクトストレージへのアクセスに必要な AWS Access Key および Secret Key を入力します。
** Azure Blob からリストアする場合は、デスティネーションボリュームが配置されている ONTAP クラスタ内の IPspace を入力します。


. 次に、ファイルを復元する * Volume * と * Folder * を選択します。
+
image:screenshot_restore_select_dest.png["リストアするファイルのボリュームとフォルダを選択するスクリーンショット。"]

+
ファイルを復元する場合は、いくつかのオプションがあります。

+
** 上の図のように、 [ ターゲットフォルダの選択 ] を選択した場合は、次のようになります。
+
*** 任意のフォルダを選択できます。
*** フォルダにカーソルを合わせて、をクリックできます image:button_subfolder.png[""] 行の末尾にあるサブフォルダをドリルダウンし、フォルダを選択します。


** ソースファイルがある場所と同じ宛先作業環境とボリュームを選択した場合は、「ソースフォルダーパスを保持」を選択して、ソース構造内に存在していた同じフォルダーにファイルまたはすべてのファイルを復元できます。同じフォルダとサブフォルダがすべて存在している必要があります。フォルダは作成されません。


. リストアの進行状況を確認できるように、 * リストア * をクリックするとリストアダッシュボードに戻ります。


リストア・インスタンスは、アクティブなときにのみコストが発生するように、一定の非アクティブ期間後にシャットダウンされます。
