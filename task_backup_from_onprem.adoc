---
sidebar: sidebar 
permalink: task_backup_from_onprem.html 
keywords: backing up, back up, backup, backup cloud volumes ontap, back up cloud volumes ontap, cloud volumes ontap, on-prem, on-premises, back up volumes, cloud backup, cloud backup service, backup and compliance 
summary: オンプレミスの ONTAP システムからパブリッククラウドの低コストのオブジェクトストレージへのデータのバックアップを開始するには、いくつかの手順を実行します。これには、 Amazon S3 と Azure Blob でのバックアップファイルの作成も含まれます。 
---
= オンプレミスの ONTAP データをパブリッククラウドにバックアップする
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
オンプレミスの ONTAP システムからパブリッククラウドの低コストのオブジェクトストレージへのデータのバックアップを開始するには、いくつかの手順を実行します。これには、 Amazon S3 と Azure Blob でのバックアップファイルの作成も含まれます。

2021 年 1 月にリリースされたベータ機能を使用すると、バックアップされたボリュームに対して、オンプレミスシステムからコンプライアンススキャンを実行できます。通常、コンプライアンススキャンでは最大 1TB のデータを解放し、サービスのコストは 1TB を超えるデータに対して適用されます。オンプレミスボリュームにバックアップとコンプライアンスを組み合わせる場合、オンプレミスボリューム上のスキャンのコストは無料です。詳細については、こちらをご覧ください link:concept_cloud_compliance.html["クラウドコンプライアンス"^] ビジネスアプリケーションとクラウド環境のプライバシーを確保できます。



== クイックスタート

これらの手順を実行してすぐに作業を開始するか、残りのセクションまでスクロールして詳細を確認してください。



==== 構成がサポートされていることを確認します

* オンプレミスクラスタを検出し、 Cloud Manager の作業環境に追加しておきます。を参照してください link:task_discovering_ontap.html["ONTAP クラスタの検出"^] を参照してください。
+
** クラスタで ONTAP 9.7P5 以降が実行されています。
** クラスタには SnapMirror ライセンスがあり、これは PREM または Data Protection Bundle に含まれています。


* に登録しておきます https://azuremarketplace.microsoft.com/en-us/marketplace/apps/netapp.cloud-manager?tab=Overview["Azure"^] または https://aws.amazon.com/marketplace/pp/B07QX2QLXX["AWS"^] Cloud Manager Marketplace のバックアップ製品またはを購入済みである link:task_managing_licenses.html#adding-and-updating-your-backup-byol-license["アクティブ化されます"^] NetApp の Cloud Backup BYOL ライセンス。
* バックアップを格納するオブジェクトストレージスペース用の有効なクラウドプロバイダサブスクリプションが必要です。
* AWS の場合、 ONTAP クラスタが S3 にデータをバックアップできるように、アクセスキーと必要な権限を持つアカウントが必要です。




==== システムで Cloud Backup を有効にします

[role="quick-margin-para"]
作業環境を選択し、右パネルの [ バックアップとコンプライアンス ] サービスの横にある [ 有効化 ] をクリックして、セットアップウィザードに従います。

[role="quick-margin-para"]
image:screenshot_backup_from_onprem_activate.png["オンプレミスの作業環境を選択した後に使用できる [ バックアップとコンプライアンスのアクティブ化 ] ボタンを示すスクリーンショット。"]



==== クラウドプロバイダを選択し、プロバイダの詳細を入力します

[role="quick-margin-para"]
プロバイダを選択し、プロバイダの詳細を入力します。また、ボリュームが配置されている ONTAP クラスタ内の IPspace を指定する必要があります。

[role="quick-margin-para"]
* 注： * オンプレミス ONTAP システムから Google Cloud Storage へのバックアップは、現在 UI ではサポートされていません。



==== バックアップポリシーを定義

[role="quick-margin-para"]
デフォルトポリシーでは、毎日ボリュームがバックアップされ、各ボリュームの最新の 30 個のバックアップコピーが保持されます。週単位または月単位のバックアップに変更するか、システム定義のポリシーの中からいくつかのオプションを選択します。

[role="quick-margin-para"]
image:screenshot_backup_onprem_policy.png["クラウドバックアップの設定を示すスクリーンショット。バックアップのスケジュールと保持期間を選択できます。"]



==== バックアップするボリュームを選択します

[role="quick-margin-para"]
クラスタからバックアップするボリュームを特定します。



==== バックアップしたボリュームで Compliance スキャンをアクティブ化（オプション）

[role="quick-margin-para"]
クラウドにバックアップされているボリュームを Cloud Compliance でスキャンするかどうかを選択します。



==== 必要に応じて、データをリストアします

[role="quick-margin-para"]
バックアップ全体を新しいボリュームにリストアするか、またはバックアップから既存のボリュームに個々のファイルをリストアするかを選択します。同じクラウドプロバイダを使用している Cloud Volumes ONTAP システムやオンプレミスの ONTAP システムにデータをリストアできます。

[role="quick-margin-para"]
を参照してください link:task_restore_backups.html["バックアップファイルからのボリュームデータのリストア"^] を参照してください。



== 要件

オンプレミスボリュームをオブジェクトストレージにバックアップする前に、次の要件を確認し、サポートされている構成であることを確認してください。

次の図は、オンプレミスの ONTAP システムを Amazon S3 にバックアップする場合と、それらの間の接続を準備する必要がある場合の各コンポーネントを示しています。

image:diagram_cloud_backup_onprem_aws.png["Cloud Backup が、ソースシステム上のボリュームおよびバックアップファイルが配置されているデスティネーションストレージと通信する仕組みを示す図。"]

次の図は、オンプレミスの ONTAP システムを Azure Blob にバックアップする場合の各コンポーネントと、その間の準備に必要な接続を示しています。

image:diagram_cloud_backup_onprem_azure.png["Cloud Backup が、ソースシステム上のボリュームおよびバックアップファイルが配置されているデスティネーションストレージと通信する仕組みを示す図。"]



=== ONTAP クラスタの準備

クラウドストレージにデータをバックアップするときは、 ONTAP クラスタが次の要件を満たしている必要があります。

ONTAP の要件::
+
--
SnapMirror ライセンス（ PREM または Data Protection Bundle に含まれます）。

--
クラスタネットワークの要件::
+
--
* ONTAP クラスタが、クラウドオブジェクトストレージへのポート 443 経由の HTTPS 接続を開始します。
+
ONTAP は、オブジェクトストレージとの間でデータの読み取りと書き込みを行います。オブジェクトストレージが開始されることはなく、応答するだけです。

* コネクタからのインバウンド接続が必要です。この接続は、使用しているオブジェクトストレージプロバイダに応じて AWS VPC または Azure VNet に配置できます。
+
クラスタと Cloud Backup Service の間の接続は必要ありません。

* クラスタ間 LIF は、バックアップ対象のボリュームをホストする各 ONTAP ノードに必要です。LIF は、 ONTAP がオブジェクトストレージへの接続に使用する IPspace に関連付けられている必要があります。 http://docs.netapp.com/ontap-9/topic/com.netapp.doc.dot-cm-nmg/GUID-69120CF0-F188-434F-913E-33ACB8751A5D.html["IPspace の詳細については、こちらをご覧ください"^]。
+
Cloud Backup をセットアップすると、 IPspace で使用するように求められます。各 LIF を関連付ける IPspace を選択する必要があります。これは、「デフォルト」の IPspace または作成したカスタム IPspace です。



--




=== ONTAP クラスタを検出しています

ボリュームデータのバックアップを開始する前に、 Cloud Manager でオンプレミスの ONTAP 作業環境を作成する必要があります。

link:task_discovering_ontap.html["クラスタの検出方法について説明します"]。



=== コネクタの作成または切り替え

コネクタは、データをクラウドにバックアップするために必要です。コネクタは、デスティネーションオブジェクトストレージと同じクラウドプロバイダになければなりません。たとえば、 AWS S3 にデータをバックアップする場合は、 AWS VPC 内のコネクタを使用する必要があります。オンプレミスに導入されているコネクタは使用できません。新しいコネクターを作成するか、現在選択されているコネクターが正しいプロバイダーにあることを確認する必要があります。

* link:concept_connectors.html["コネクタについて説明します"]
* link:task_creating_connectors_aws.html["AWS でコネクタを作成する"]
* link:task_creating_connectors_azure.html["Azure でコネクタを作成する"]
* link:task_managing_connectors.html["コネクタ間の切り替え"]




=== コネクタのネットワークを準備しています

コネクタに必要なネットワーク接続があることを確認します。

.手順
. コネクタが取り付けられているネットワークで次の接続が有効になっていることを確認します。
+
** Cloud Backup Service へのアウトバウンドインターネット接続 ポート 443 （ HTTPS ）
** ポート 443 経由でオブジェクトストレージに HTTPS 接続する （ S3 または Blob ）
** ONTAP クラスタへのポート 443 経由の HTTPS 接続


. オブジェクトストレージのエンドポイントを有効にします。
+
** for AWS ： S3 に対して VPC エンドポイントを有効にします。ONTAP クラスタから VPC への Direct Connect または VPN 接続が確立されている環境で、コネクタと S3 の間の通信を AWS 内部ネットワークのままにする場合は、この接続が必要です。
** Azure の場合： Azure ストレージへの VNet サービスエンドポイントを有効にします。これは、 ONTAP クラスタから VNet への ExpressRoute または VPN 接続があり、コネクタと BLOB ストレージ間の通信を仮想プライベートネットワークのままにする場合に必要です。






=== サポートされている地域

オンプレミスシステムからパブリックシステムへのバックアップを作成できます すべての地域でクラウドを利用できます https://cloud.netapp.com/cloud-volumes-global-regions["Cloud Volumes ONTAP がサポートされている場合"^]。

* Azure では、サービスのセットアップ時にバックアップを格納するリージョンを指定します。
* AWS の場合、バックアップは Cloud Manager がインストールされているリージョンに格納されます。


* 注： * オンプレミス ONTAP システムから Google Cloud Storage へのバックアップは、現在 UI ではサポートされていません。



=== ライセンス要件

Cloud Backup PAYGO ライセンスの場合は、へのサブスクリプションが必要です https://azuremarketplace.microsoft.com/en-us/marketplace/apps/netapp.cloud-manager?tab=Overview["Azure"^] または https://aws.amazon.com/marketplace/pp/B07QX2QLXX["AWS"^] Cloud Backup を有効にする前に、 Cloud Manager Marketplace のバックアップサービスを利用できます。Cloud Backup の請求は、このサブスクリプションを通じて行われます。

Cloud Backup BYOL ライセンスを使用するには、ライセンスの期間と容量にサービスを使用できるように、ネットアップから提供されたシリアル番号が必要です。を参照してください link:task_managing_licenses.html#adding-and-updating-your-backup-byol-license["バックアップ BYOL ライセンスを追加および更新する"^]。

また、バックアップを格納するオブジェクトストレージスペースについて、クラウドプロバイダからのサブスクリプションが必要になります。



=== バックアップのための Amazon S3 の準備

Amazon S3 を使用している場合は、 Cloud Manager が S3 バケットにアクセスするための権限を設定する必要があります。また、オンプレミスの ONTAP クラスタが S3 バケットにアクセスできるように権限を設定する必要があります。

.手順
. 最新のから次の S3 権限を指定します https://mysupport.netapp.com/site/info/cloud-manager-policies["Cloud Manager ポリシー"^]）を作成して、 Cloud Manager に権限を付与する IAM ロールに付与します。
+
[source, json]
----
{
            "Sid": "backupPolicy",
            "Effect": "Allow",
            "Action": [
                "s3:DeleteBucket",
                "s3:GetLifecycleConfiguration",
                "s3:PutLifecycleConfiguration",
                "s3:PutBucketTagging",
                "s3:ListBucketVersions",
                "s3:GetObject",
                "s3:ListBucket",
                "s3:ListAllMyBuckets",
                "s3:GetBucketTagging",
                "s3:GetBucketLocation",
                "s3:GetBucketPolicyStatus",
                "s3:GetBucketPublicAccessBlock",
                "s3:GetBucketAcl",
                "s3:GetBucketPolicy",
                "s3:PutBucketPublicAccessBlock"
            ],
            "Resource": [
                "arn:aws:s3:::netapp-backup-*"
            ]
        },
----
. ONTAP クラスタから S3 にデータをバックアップできるように、 IAM ユーザに次の権限を付与します。
+
[source, json]
----
"s3:ListAllMyBuckets",
"s3:ListBucket",
"s3:GetBucketLocation",
"s3:GetObject",
"s3:PutObject",
"s3:DeleteObject"
----
+
を参照してください https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-user.html["AWS ドキュメント：「 Creating a Role to Delegate Permissions to an IAM User"^] を参照してください。

. アクセスキーを作成または検索します。
+
Cloud Backup が ONTAP クラスタにアクセスキーを渡します。クレデンシャルは Cloud Backup Service には保存されません。

+
を参照してください https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html["AWS ドキュメント：「 Managing Access Keys for IAM Users"^] を参照してください。





== Cloud Backup を有効にしています

Cloud Backup は、オンプレミスの作業環境からいつでも直接有効にできます。

.手順
. キャンバスから作業環境を選択し、右パネルのバックアップとコンプライアンスサービスの横にある [ アクティブ化 ] をクリックします。
+
image:screenshot_backup_from_onprem_activate.png["オンプレミスの作業環境を選択した後に使用できる [ バックアップとコンプライアンスのアクティブ化 ] ボタンを示すスクリーンショット。"]

. プロバイダを選択し、プロバイダの詳細を入力します。
+
** Azure の場合は次のように入力します
+
... バックアップおよびバックアップを格納する Azure リージョンで使用する Azure サブスクリプション。
... リソースグループ - 新しいリソースグループを作成することも、を選択して既存のリソースグループを選択することもできます。
... バックアップするボリュームが配置されている ONTAP クラスタ内の IPspace 。
+
image:screenshot_backup_onprem_to_azure.png["バッキング時にクラウドプロバイダの詳細を示すスクリーンショット オンプレミスクラスタから Azure Blob にボリュームをバックアップ 階層"]



** AWS の場合は次のように入力します
+
... バックアップの格納に使用する AWS Access Key および Secret Key 。
... バックアップするボリュームが配置されている ONTAP クラスタ内の IPspace 。
+
image:screenshot_backup_onprem_to_aws.png["バッキング時にクラウドプロバイダの詳細を示すスクリーンショット オンプレミスクラスタから AWS S3 へ、複数のボリュームをバックアップできます 階層"]

+
この情報は、サービスの開始後は変更できないことに注意してください。





. [* Continue （続行） ] をクリックします。
. [_Define Policy_] ページで、バックアップスケジュールと保持の値を選択し、 [* Continue * ] をクリックします。
+
image:screenshot_backup_onprem_policy.png["クラウドバックアップの設定を示すスクリーンショット。バックアップのスケジュールと保持期間を選択できます。"]

+
を参照してください link:concept_backup_to_cloud.html#the-schedule-is-daily-weekly-monthly-or-a-combination["既存のポリシーのリスト"^]。

. バックアップするボリュームを選択します。
+
** すべてのボリュームをバックアップするには、タイトル行（image:button_backup_all_volumes.png[""]）。
** 個々のボリュームをバックアップするには、各ボリュームのボックス（image:button_backup_1_volume.png[""]）。
+
image:screenshot_backup_select_onprem_volumes.png["バックアップするボリュームを選択するスクリーンショット。"]



. Activate * をクリックすると、 Cloud Backup はボリュームの初期バックアップの作成を開始します。
+
バックアップされたボリュームでコンプライアンススキャンを実行するかどうかを確認するメッセージが表示されます。Cloud Compliance スキャンは、実行時に無料で実行できます バックアップされたボリューム（を除く） link:concept_cloud_compliance.html#cost["導入された Cloud Compliance インスタンスのコスト"^]）。

+
image:screenshot_compliance_on_backups.png["バックアップしたボリュームで Cloud Compliance をアクティブ化するように選択できるページのスクリーンショット。"]

. コンプライアンスへ移動 * をクリックして、ボリュームのコンプライアンススキャンをアクティブ化します。（バックアップされたボリュームをスキャンせずに * Close * を選択すると、いつでもスキャンできます link:task_getting_started_compliance.html#scanning-backup-files-from-on-premises-ontap-systems["この機能を有効にします"^] Cloud Compliance を後で参照）。
+
** Cloud Compliance のインスタンスがすでに環境に導入されている場合は、バックアップがある各オンプレミスの作業環境でスキャンするボリュームを設定ページで選択するように求められます。を参照してください link:task_getting_started_compliance.html#enabling-cloud-compliance-in-your-working-environments["ボリュームを選択する方法"^]。
+
image:screenshot_compliance_onprem_backups.png["スキャンするボリュームを選択するためのコンプライアンスページのスクリーンショット。"]

** クラウドコンプライアンスが導入されていない場合は、コンプライアンスページが表示され、クラウドまたは社内にコンプライアンスを導入できます。クラウドに導入することを強く推奨します。実行します link:task_deploy_cloud_compliance.html["こちらをご覧ください"^] を参照してください。
+
image:screenshot_cloud_compliance_deploy_options.png["Cloud Compliance の導入方法を選択するためのコンプライアンスページのスクリーンショット。"]

+
Compliance の導入が完了したら、上記の手順でスキャンするボリュームを選択できます。





Cloud Backup は、オンプレミスの ONTAP システムからボリュームをバックアップします。必要に応じて、 Cloud Compliance はバックアップしたボリュームに対してコンプライアンススキャンを実行します。

可能です link:task_managing_backups.html["ボリュームのバックアップを開始および停止したり、バックアップを変更したりできます スケジュール"^] また、次のことも可能です link:task_restore_backups.html["ボリューム全体または個々のファイルをバックアップファイルからリストアする"^]。

また可能です link:task_controlling_private_data.html["コンプライアンススキャンの結果を表示します"^] また、データコンテキストを理解し、組織内の機密データを識別するのに役立つ、 Cloud Compliance のその他の機能についても確認できます。


NOTE: Cloud Compliance で準拠スキャンを開始するにはバックアップの作成を完了する必要があるため、スキャン結果はすぐには使用できません。
