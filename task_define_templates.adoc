---
sidebar: sidebar 
permalink: task_define_templates.html 
keywords: templates, resource templates, application templates, volume templates 
summary: ネットアップが提供する「アクション」を 1 つ以上選択し、組織がリソース作成の最適化を開始するために使用できるアプリケーションテンプレートを迅速に構築します。 
---
= 組織のアプリケーションテンプレートを作成する
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
ネットアップが提供する「アクション」を 1 つ以上選択し、組織がリソース作成の最適化を開始するために使用できるアプリケーションテンプレートを迅速に構築します。



== クイックスタート

これらの手順を実行すると、すぐに作業を開始できます。また、残りのセクションまでスクロールして詳細を確認することもできます。



==== 必要な前提条件を確認する

* ユーザがテンプレートを使用して Cloud Volumes ONTAP または Azure NetApp Files ボリュームを作成する前に、ボリュームを導入する Cloud Volumes ONTAP または Azure NetApp Files の作業環境にアクセスできることを確認してください。


* クラウドサービス「 action 」をテンプレートに追加する場合（など） link:concept_backup_to_cloud.html["クラウドバックアップ"^]を使用して、ライセンスが付与されたアクティブな Cloud Backup Service が環境内にあることを確認します。




==== Application Templates サービスを起動します

[role="quick-margin-para"]
[* AppTemplate] サービスを選択し、テンプレートを選択します。



==== 「アクション」を選択し、パラメーターを定義して、テンプレートを作成します

[role="quick-margin-para"]
作成手順に従い、テンプレートによって実行されるアクションを定義します。



== 要件

以下の要件を読み、サポートされている構成になっていることを確認してください。

* コネクタがない場合は、 link:concept_connectors.html["コネクターの作成方法を参照してください"^] AWS 、 Azure 、 GCP 向け。
* Cloud Volumes ONTAP ボリュームテンプレートを作成する際には、 Cloud Volumes ONTAP 作業環境がユーザに利用できることを確認してください。で Cloud Volumes ONTAP システムを起動する方法を参照してください link:task_deploying_otc_aws.html["AWS"^]、 link:task_deploying_otc_azure.html["Azure"^]または、のいずれかです link:task_deploying_gcp.html["GCP"^]。
* Azure NetApp Files ボリュームテンプレートを作成する際には、 Azure NetApp Files の作業環境がユーザに割り当てられていることを確認します。方法を参照してください link:task_manage_anf.html["Azure NetApp Files 作業環境を作成します"^] をクリックします。
* Cloud Volumes ONTAP ボリュームでクラウドバックアップを有効にする場合は、ライセンスが設定されたアクティブな Cloud Backup Service を環境内で使用していることを確認してください。
* Cloud Volumes ONTAP または Azure NetApp Files ボリュームで Cloud Compliance を有効にする場合は、アクティブな、ライセンスが設定された Cloud Compliance サービスが環境にあることを確認してください。




== 特殊なテンプレートコントロール

テンプレートの作成を開始する前に、テンプレート内のパラメータの値を事前に入力するときに設定できるいくつかの特別なオプションについて理解しておく必要があります。

image:screenshot_template_options.png["パラメータ値に設定可能な編集可能オプションとドリフトオプションのスクリーンショット。"]

* 編集可能なチェックボックス *

このチェックボックスをオンにすると、ストレージ管理者は、テンプレートで入力した値よりも優先されます。ストレージ管理者は値を提案しますが、リソースの作成時に値をカスタマイズできます。

オフにした場合、ユーザーは値を変更できず、管理者がリソースを展開するときにテンプレート内のハードコードされた値が常に使用されます。

* フィールドに正規表現（ regex ）を使用する *

テンプレートには、管理者がフィールドに入力できる値を定義するための正規表現を入力できるフィールドがいくつかあります。たとえば、「ボリューム名」や「共有名」などです。

image:screenshot_template_regex.png["ボリューム名に使用できる値を定義する正規表現を使用するスクリーンショット。"]

たとえば、ボリューム名の正規表現として「 ^[a-zA-Z][0-9aa-zA-Za-z_]{0,149}$ 」と入力すると、「 _The name 」はアルファベットで始まる必要があります。使用できる文字は、数字、アルファベット、またはアンダースコアのみで、 150 文字以下である必要があります。



== テンプレートアクション間で値を渡す

テンプレートには、前のアクションの情報を使用して、将来のアクションでフィールドにデータを入力する機能があります。たとえば、クラウドバックアップ機能を有効にするボリュームの名前を定義する際に、 Create Cloud Volumes ONTAP アクションで、ボリューム名として入力したストレージ管理者の値を使用するようにバックアップアクションを設定できます。

AppTemplate サービスが以前のアクションから使用できる情報には、次の 2 種類があります。

* 入力値 - 以前のテンプレートアクションでストレージ管理者がフィールドに入力した実際の値です。
* 出力値 - これは、前のテンプレートアクションからリソースを作成したあとに Cloud Manager によって生成される値です。


たとえば、ボリュームに対して Compliance を有効にするには、ストレージ管理者が入力するボリューム名（入力値）と、 Cloud Manager がボリュームを作成するときに生成する「ボリューム UUID 」（出力値）の両方が必要です。

次の図は、テンプレートの Cloud Compliance アクションセクションでこの情報を入力する方法を示しています。

image:screenshot_template_variable_input_output.png["前のアクションで入力した値を使用して別のアクションのフィールドに入力する方法を示す図。"]



== Cloud Volumes ONTAP ボリューム用のテンプレートを作成する

を参照してください link:task_provisioning_storage.html#creating-flexvol-volumes["Cloud Volumes ONTAP ボリュームをプロビジョニングする方法"^] Cloud Volumes ONTAP ボリュームテンプレートで実行する必要があるすべてのパラメータの詳細については、を参照してください。

この例では、「データベース用の CVO ボリューム」という名前のテンプレートを作成し、次の 2 つのアクションを含めます。

* Cloud Volumes ONTAP ボリュームを作成します
+
AWS 環境のボリュームを 100GB のストレージで設定し、 Snapshot ポリシーを「 default 」に設定し、 Storage Efficiency を有効にします。

* Cloud Backup を有効にします
+
日次バックアップを作成し、保持数を 30 に設定します。



.手順
. * AppTemplate* サービスを選択し、 * 新規テンプレートの追加 * をクリックします。
+
Select_a Template_page が表示されます。

+
image:screenshot_create_template_primary_action_cvo.png["このテンプレートを使用して実行する主なアクションの選択方法を示すスクリーンショット。"]

. 作成するリソースのタイプとして * Cloud Volumes ONTAP + Backup * のボリュームを選択し、 * Get Started * をクリックします。
+
Cloud Volumes ONTAP アクション定義ページでのボリュームの作成（ _Create Volume in Action Definition_page ）が表示されます。

+
image:screenshot_create_template_define_action_cvo.png["入力が必要な空の CVO テンプレートを示すスクリーンショット。"]

. * 詳細： * ボリュームの名前とサイズを入力します。
+
[cols="25,75"]
|===
| フィールド | 説明 


| ボリューム名 | フィールド内をクリックし、 5 つのオプションのいずれかを選択します。任意の名前を入力するには、 * Free Text * を選択します。ボリューム名に特定のプレフィックスまたはサフィックスを付けるか、 _contains_certain 文字を指定するか、または入力した正規表現（ regex ）のルールに従うように指定することもできます。たとえば、「 db 」には必須のプレフィックス、サフィックス、またはに次の名前を指定できます。「 db_vol1 」、「 vol1_db 」、「 vol_db_1 」などのボリューム名を追加するようユーザに要求できます。 


| ボリュームサイズ | 許容値の範囲を指定することも、固定サイズを指定することもできます。この値は GB 単位です。この例では、固定値 *100* を追加できます。 
|===
. * 保護： * 「 default 」またはその他のポリシーを選択して Snapshot コピーを作成するか、 Snapshot コピーを作成しない場合は「 None 」を選択します。
. * 使用プロファイル： * ネットアップの Storage Efficiency 機能をボリュームに適用するかどうかを選択します。これには、シンプロビジョニング、重複排除、圧縮が含まれます。この例では、 Storage Efficiency を有効にしておきます。
. * ディスクタイプ：クラウドストレージプロバイダとディスクタイプを選択ディスクの選択によっては、最小および最大の IOPS またはスループット（ MB/ 秒）値を選択することもできます。基本的には、特定の Quality of Service （ QoS ；サービス品質）を定義します。
. * プロトコル： * nfs * または * smb * を選択して、ボリュームのプロトコルを設定します。次に、プロトコルの詳細を指定します。
+
[cols="25,75"]
|===
| NFS フィールド | 説明 


| Access Control の略 | ボリュームへのアクセスにアクセス制御が必要かどうかを選択します。 


| エクスポートポリシー | ボリュームにアクセスできるサブネット内のクライアントを定義するエクスポートポリシーを作成します。 


| NFS バージョン | ボリュームの NFS バージョンを選択します。 _nfsv3_or_nfsv4_ 、またはその両方を選択できます。 
|===
+
[cols="25,75"]
|===
| SMB フィールド | 説明 


| 共有名 | フィールド内をクリックし、 5 つのオプションのいずれかを選択します。任意の名前（フリーテキスト）を入力するか、共有名に特定のプレフィックスまたはサフィックスを付加する、 _contains_certain 文字を使用する、または入力した正規表現（ regex ）のルールに従うように指定できます。 


| 権限 | ユーザとグループ（アクセス制御リストまたは ACL とも呼ばれる）の共有へのアクセスのレベルを選択します。 


| ユーザ / グループ | ローカルまたはドメインの Windows ユーザまたはグループ、あるいは UNIX ユーザまたはグループを指定します。ドメインの Windows ユーザ名を指定する場合は、 domain\username 形式でユーザのドメインを指定する必要があります。 
|===
. * 階層化ポリシー： * ボリュームに適用する階層化ポリシーを選択します。このボリュームからオブジェクトストレージにコールドデータを階層化しない場合は、「なし」に設定します。
+
を参照してください link:concept_data_tiering.html#volume-tiering-policies["ボリューム階層化ポリシー"^] 概要については、およびを参照してください link:task_tiering.html["使用頻度の低いデータをオブジェクトストレージに階層化します"^] をクリックして、環境が階層化用に設定されていることを確認してください。

. このアクションに必要なパラメーターを定義したら、 * 適用 * をクリックする。
+
テンプレートの値が正しく入力されている場合は、 [ ボリュームを Cloud Volumes ONTAP に作成 ] ボックスの周りに緑のボックスが表示されます。

. クラウドバックアップを有効にする * ボックスをクリックすると、クラウドバックアップアクション定義を有効にする _ ダイアログが表示され、クラウドバックアップの詳細を入力できます。
+
image:screenshot_create_template_add_action.png["作成したボリュームに追加できるその他の操作を示すスクリーンショット。"]

. 日次バックアップを作成するバックアップポリシーを定義し、 30 日間の保持期間を設定します。
. ボリューム名フィールドの下には、バックアップを有効にするボリュームを示す 3 つのフィールドがあります。を参照してください <<Passing values between template actions,これらのフィールドの入力方法>>。
. [ 適用 ] をクリックすると、 [ クラウドバックアップ ] ダイアログが保存されます。
. 左上に、データベース * （この例では）のテンプレート名 * CVO ボリュームを入力してください。
. このテンプレートを他の同様のテンプレートと区別できるように詳細な概要を指定する場合は、 [ * テンプレート設定 * ] をクリックして、 [ * 適用 * ] をクリックします。
. [ テンプレートの保存 *] をクリックします。


テンプレートが作成され、新しいテンプレートが表示されるテンプレートダッシュボードに戻ります。

を参照してください <<What to do after you have created the template,テンプレートについてユーザに説明する必要がある内容>>。



== Azure NetApp Files ボリューム用のテンプレートを作成する

Azure NetApp Files ボリュームのテンプレートは、 Cloud Volumes ONTAP ボリュームのテンプレートを作成する場合と同じ方法で作成します。

を参照してください link:task_manage_anf_volumes.html#creating-volumes["Azure NetApp Files ボリュームをプロビジョニングする方法"^] ANF ボリュームテンプレートで実行する必要があるすべてのパラメータの詳細については、を参照してください。

.手順
. * AppTemplate* サービスを選択し、 * 新規テンプレートの追加 * をクリックします。
+
Select_a Template_page が表示されます。

+
image:screenshot_create_template_primary_action_anf.png["このテンプレートを使用して実行する主なアクションの選択方法を示すスクリーンショット。"]

. 作成するリソースのタイプとして * Volume for Azure NetApp Files * を選択し、 * Get Started * をクリックします。
+
Azure NetApp Files アクション定義ページでのボリュームの作成（ _Create Volume in Action Definition_page ）が表示されます。

+
image:screenshot_create_template_define_action_anf.png["入力する必要がある空の ANF テンプレートを示すスクリーンショット。"]

. * 詳細： * 新規または既存の Azure NetApp Files アカウントの詳細を入力します。
+
[cols="25,75"]
|===
| フィールド | 説明 


| ネットアップアカウント名 | アカウントに使用する名前を入力します。 


| Azure サブスクリプション ID | Azure サブスクリプション ID を入力します。これは、「 2b04f26-7de6-42eb-9234-e2903d7s327 」のような形式のフル ID です。 


| 地域 | を使用してリージョンを入力します https://docs.microsoft.com/en-us/dotnet/api/microsoft.azure.documents.locationnames?view=azure-dotnet#fields["内部リージョン名"^]。 


| リソースグループ名 | 使用するリソースグループの名前を入力します。 


| Capacity Pool Name の略 | 既存の容量プールの名前を入力します。 
|===
. * ボリュームの詳細： * ボリュームの名前とサイズ、ボリュームを配置する VNet とサブネット、および必要に応じてボリュームのタグを指定します。
+
[cols="25,75"]
|===
| フィールド | 説明 


| ボリューム名 | フィールド内をクリックし、 5 つのオプションのいずれかを選択します。任意の名前を入力するには、 * Free Text * を選択します。ボリューム名に特定のプレフィックスまたはサフィックスを付けるか、 _contains_certain 文字を指定するか、または入力した正規表現（ regex ）のルールに従うように指定することもできます。たとえば、「 db 」には必須のプレフィックス、サフィックス、またはに次の名前を指定できます。「 db_vol1 」、「 vol1_db 」、「 vol_db_1 」などのボリューム名を追加するようユーザに要求できます。 


| ボリュームサイズ | 許容値の範囲を指定することも、固定サイズを指定することもできます。この値は GB 単位です。 


| サブネット | VNet とサブネットを入力します。この値には、完全パスが含まれます。形式は「 /subscription/<subscription_id>/resourceGroups/<resource_group>/provider/Microsoft.Network/virtualNetworks/<vpc_name>/subnets/<subhet_name>" です。 
|===
. * プロトコル：ボリュームのプロトコルを設定するには、 * nfsv3 * 、 * NFSv4.1 * 、または * smb * を選択します。次に、プロトコルの詳細を指定します。
+
[cols="25,75"]
|===
| NFS フィールド | 説明 


| ボリュームパス | 5 つのオプションのいずれかを選択します。管理者が任意のパスを入力できるようにするには、 * フリーテキスト * を選択するか、パス名に特定の接頭辞または接尾辞を付けるか、 _contains_certain 文字を使用するか、または入力した正規表現（ regex ）の規則に従うように指定します。 


| エクスポートポリシールール | ボリュームにアクセスできるサブネット内のクライアントを定義するエクスポートポリシーを作成します。 
|===
+
[cols="25,75"]
|===
| SMB フィールド | 説明 


| ボリュームパス | 5 つのオプションのいずれかを選択します。管理者が任意のパスを入力できるようにするには、 * フリーテキスト * を選択するか、パス名に特定の接頭辞または接尾辞を付けるか、 _contains_certain 文字を使用するか、または入力した正規表現（ regex ）の規則に従うように指定します。 
|===
. * Snapshot コピー： * 既存のボリュームの特性を使用して新しいボリュームを作成する場合は、既存のボリューム Snapshot の Snapshot ID を入力します。
. このアクションに必要なパラメータを定義したら、 * 次へ * をクリックします。
. 現時点では ANF ボリュームに対して実行できる操作はないため、「 * 次へ」をクリックしてください。
. テンプレートに使用する名前を左上に入力します。
. このテンプレートを他の同様のテンプレートと区別できるように詳細な概要を指定する場合は、 [ * テンプレート設定 * ] をクリックして、 [ * 適用 * ] をクリックします。
. 将来的には、 _ ドリフトの構成 _ ページでは、ドリフトフィーチャーをテンプレートに適用するかどうかを選択できます。これにより、 Cloud Manager はこのテンプレートの作成時に入力したパラメータのハードコーディング値を監視できます。
. [ テンプレートの作成 *] をクリックします。


テンプレートが作成され、新しいテンプレートが表示されるテンプレートダッシュボードに戻ります。

を参照してください <<What to do after you have created the template,テンプレートについてユーザに説明する必要がある内容>>。



== テンプレートの作成後の作業

テンプレートを作成したら、新しいボリュームの作成時にテンプレートを使用するようストレージ管理者に通知する必要があります。

将来、作業環境にボリュームを追加する場合は、「 * テンプレートからボリュームを追加」を選択する必要があります。このオプションは '_Working Environment_page および _Volume Details_page から選択できますを参照してください link:task_provisioning_storage.html#creating-volumes-from-templates["Cloud Volumes ONTAP ボリュームをプロビジョニングする方法"^] または link:task_manage_anf_volumes.html#creating-volumes-from-templates["Azure NetApp Files ボリュームをプロビジョニングする方法"^] テンプレートを使用する。

image:screenshot_template_add_vol_from.png["テンプレートから新しいボリュームを作成する方法を示すスクリーンショットが 2 つあります。"]



== テンプレートを編集および削除する

パラメータを変更する必要がある場合は、テンプレートを変更できます。変更を保存すると、テンプレートから作成された以降のすべてのリソースに新しいパラメータ値が使用されます。

不要になったテンプレートを削除することもできます。テンプレートを削除しても、そのテンプレートで作成されたリソースには影響しません。

image:screenshot_template_edit_remove.png["テンプレートを変更または削除する方法を示すスクリーンショット。"]
