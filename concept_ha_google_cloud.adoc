---
sidebar: sidebar 
permalink: concept_ha_google_cloud.html 
keywords: high availability, HA, mediator, concepts, understanding, overview, takeover, giveback, rpo, rto, nondisruptive, ha pairs, node, nodes, synchronous, resync, recovery point objective, recovery time objective, failover, mount, remount, failure, data access, access, ip address, performance, gcp, gcp ha, google cloud ha, ha in google cloud 
summary: Cloud Volumes ONTAP のハイアベイラビリティ構成は、ノンストップオペレーションとフォールトトレランスを実現します。Google Cloud Platform では、 2 つのノード間でデータが同期ミラーリングされます。 
---
= Google Cloud Platform のハイアベイラビリティペア
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Cloud Volumes ONTAP High Availability （ HA ）構成は、無停止の運用と耐障害性を提供します。Google Cloud Platform では、 2 つのノード間でデータが同期ミラーリングされます。



== HA コンポーネント

GCP の Cloud Volumes ONTAP HA 構成には、次のコンポーネントが含まれます。

* データが同期的にミラーリングされる 2 つの Cloud Volumes ONTAP ノード。
* ストレージのテイクオーバーとギブバックプロセスを支援するためにノード間の通信チャネルを提供するメディエータインスタンス。
+
メディエーターは、 F1 マイクロインスタンス上で Linux オペレーティングシステムを実行し、それぞれ 10 GB の標準永続ディスクを 2 つ使用します。

* 1 つまたは 3 つのゾーン（推奨）。
+
3 つのゾーンを選択すると、 2 つのノードとメディエーターが別々の Google Cloud ゾーンに配置されます。

* 4 つの Virtual Private Cloud （ VPC ；仮想プライベートクラウド）
+
GCP では各ネットワークインターフェイスが別々の VPC ネットワークに存在する必要があるため、構成では 4 つの VPC を使用します。

* Cloud Volumes ONTAP HA ペアへの着信トラフィックを管理する 3 つの Google Cloud 内部ロードバランサ（ TCP / UDP ）。（ 9.9.9..0 より前のバージョンでは、 4 つのロードバランサが作成されていました）。


link:reference_networking_gcp.html["ネットワーク要件について説明します"]ロードバランサ、 VPC 、内部 IP アドレス、サブネットなどの詳細が含まれます。

次の概念図は、 Cloud Volumes ONTAP HA ペアとそのコンポーネントを示しています。

image:diagram_gcp_ha.png[""]



== ストレージのテイクオーバーとギブバック

ノードがダウンした場合、もう一方のノードはパートナーにデータを提供して、継続的なデータサービスを提供できます。データはパートナーに同期的にミラーリングされているため、クライアントはパートナーノードから同じデータにアクセスできます。

ノードのリブート後、パートナーはデータを再同期してからストレージを返却する必要があります。データの再同期にかかる時間は、ノードがダウンしている間に変更されたデータの量によって異なります。

ストレージのテイクオーバー、再同期、ギブバックは、すべてデフォルトで自動的に実行されます。ユーザによる操作は必要ありません。



== RPO と RTO

HA 構成では、次のようにデータの高可用性が維持されます。

* RPO （ Recovery Point Objective ：目標復旧時点）は 0 秒です。
+
データはトランザクション的に整合性が保たれ、データ損失は発生しません。

* RTO （目標復旧時間）は 60 秒です。
+
システム停止が発生した場合は、 60 秒以内にデータを利用できるようにする必要があります。





== HA の導入モデル

複数のゾーンまたは単一のゾーンに HA 構成を導入することで、データの高可用性を確保できます。

複数のゾーン（推奨）:: 3 つのゾーンに HA 構成を導入することで、ゾーン内で障害が発生した場合の継続的なデータ可用性を確保できます。書き込みパフォーマンスは、単一のゾーンを使用する場合に比べてわずかに低くなりますが、最小のパフォーマンスです。
シングルゾーン::
+
--
この導入モデルでは、ゾーン間にデータ出力料金が発生しないため、コストが削減されます。

--




== HA ペアでのストレージの動作

Cloud Volumes ONTAP クラスタとは異なり、 GCP の ONTAP HA ペアのストレージはノード間で共有されません。代わりに、障害発生時にデータを利用できるように、データはノード間で同期的にミラーリングされます。



=== ストレージの割り当て

新しいボリュームを作成し、ディスクを追加する必要がある場合、 Cloud Manager は同じ数のディスクを両方のノードに割り当て、ミラーリングされたアグリゲートを作成してから、新しいボリュームを作成します。たとえば、ボリュームに 2 つのディスクが必要な場合、 Cloud Manager はノードごとに 2 つのディスクを割り当て、合計で 4 つのディスクを割り当てます。



=== ストレージ構成

HA ペアは、アクティブ / アクティブ構成として使用できます。アクティブ / アクティブ構成では、両方のノードがクライアントにデータを提供します。アクティブ / パッシブ構成では、パッシブノードは、アクティブノードのストレージをテイクオーバーした場合にのみデータ要求に応答します。



=== HA 構成に期待されるパフォーマンス

Cloud Volumes ONTAP HA 構成では、ノード間でデータを同期的にレプリケートするため、ネットワーク帯域幅が消費されます。その結果、シングルノードの Cloud Volumes ONTAP 構成と比較して、次のパフォーマンスが期待できます。

* 1 つのノードからのみデータを提供する HA 構成では、読み取りパフォーマンスはシングルノード構成の読み取りパフォーマンスと同等ですが、書き込みパフォーマンスは低くなります。
* 両方のノードからデータを提供する HA 構成の場合、読み取りパフォーマンスはシングルノード構成の読み取りパフォーマンスよりも高く、書き込みパフォーマンスは同じかそれ以上です。


Cloud Volumes ONTAP のパフォーマンスの詳細については、を参照してください link:concept_performance.html["パフォーマンス"]。



=== ストレージへのクライアントアクセス

クライアントは、ボリュームが存在するノードのデータ IP アドレスを使用して、 NFS ボリュームと CIFS ボリュームにアクセスする必要があります。NAS クライアントがパートナーノードの IP アドレスを使用してボリュームにアクセスする場合、トラフィックは両方のノード間を通過するため、パフォーマンスが低下します。


IMPORTANT: HA ペアのノード間でボリュームを移動する場合は、もう一方のノードの IP アドレスを使用してボリュームを再マウントする必要があります。そうしないと、パフォーマンスが低下する可能性があります。クライアントが CIFS の NFSv4 リファールまたはフォルダリダイレクションをサポートしている場合は、ボリュームの再マウントを回避するために、 Cloud Volumes ONTAP システムでこれらの機能を有効にできます。詳細については、 ONTAP のマニュアルを参照してください。

Cloud Manager から正しい IP アドレスを簡単に識別できます。

image:screenshot_mount.gif["スクリーンショット：ボリュームを選択したときに使用可能なマウントコマンドを表示します。"]



=== 関連リンク

* link:reference_networking_gcp.html["ネットワーク要件について説明します"]
* link:task_getting_started_gcp.html["GCP の使用を開始する方法をご確認ください"]

